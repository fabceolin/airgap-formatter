# Story 10.7: Theme Extension for Markdown

## Status: Draft

## Story

**As a** user viewing Markdown content,
**I want** the syntax highlighting and preview to match my theme preference,
**So that** the experience is consistent with the rest of the application.

## Background

Theme.qml already contains colors for JSON and XML syntax highlighting. This story extends the theme system to include Markdown-specific colors for:
1. Source code highlighting (Code view)
2. Preview pane styling (rendered HTML)
3. Mermaid diagram theming

This is a foundational story that other stories (10.5, 10.6) depend on for color definitions.

## Acceptance Criteria

1. Theme.qml extended with Markdown syntax colors:
   - Headings (h1-h6)
   - Bold, italic, strikethrough
   - Links and URLs
   - Code (inline and block)
   - Blockquotes
   - List markers
   - Mermaid block background
2. Theme.qml extended with preview pane colors:
   - Preview background
   - Preview text
   - Table borders
   - Code block background
3. Mermaid theme configuration defined:
   - Dark theme color palette
   - Light theme color palette
4. All colors meet WCAG AA contrast requirements
5. Colors documented with usage notes
6. Both dark and light themes look professional
7. Theme toggle updates Markdown views correctly

## Tasks / Subtasks

- [ ] Task 1: Add Markdown syntax colors to Theme.qml (AC: 1)
  - [ ] Add `syntaxHeading` color
  - [ ] Add `syntaxBold` color (or use existing textPrimary)
  - [ ] Add `syntaxItalic` color
  - [ ] Add `syntaxStrike` color
  - [ ] Add `syntaxLink` color
  - [ ] Add `syntaxUrl` color
  - [ ] Add `syntaxCodeInlineBg` color
  - [ ] Add `syntaxCodeBlockBg` color
  - [ ] Add `syntaxBlockquote` color
  - [ ] Add `syntaxListMarker` color
  - [ ] Add `syntaxMermaidBg` color
  - [ ] Add `syntaxMermaidBorder` color

- [ ] Task 2: Add preview pane colors to Theme.qml (AC: 2)
  - [ ] Add `previewBackground` color
  - [ ] Add `previewText` color
  - [ ] Add `previewHeading` color
  - [ ] Add `previewLink` color
  - [ ] Add `previewCodeBg` color
  - [ ] Add `previewTableBorder` color
  - [ ] Add `previewBlockquoteBorder` color

- [ ] Task 3: Define Mermaid theme configuration (AC: 3)
  - [ ] Create `mermaidDarkTheme` property with color object
  - [ ] Create `mermaidLightTheme` property with color object
  - [ ] Include: primaryColor, textColor, lineColor, background, etc.

- [ ] Task 4: Verify contrast ratios (AC: 4)
  - [ ] Check all color combinations against WCAG AA (4.5:1 for text)
  - [ ] Adjust colors if needed
  - [ ] Document contrast ratios

- [ ] Task 5: Add documentation (AC: 5)
  - [ ] Add comments explaining each color's usage
  - [ ] Group colors by purpose (syntax, preview, mermaid)

- [ ] Task 6: Test both themes (AC: 6, 7)
  - [ ] Visual review of dark theme
  - [ ] Visual review of light theme
  - [ ] Test theme toggle updates views

## Dev Notes

### Relevant Source Tree

```
qt/qml/
└── Theme.qml           # Extend with Markdown colors
```

### Theme.qml Additions

```qml
pragma Singleton
import QtQuick

QtObject {
    id: theme

    // ... existing properties ...

    // ========================================
    // Markdown Syntax Highlighting Colors
    // ========================================

    // Headings (#, ##, ###, etc.)
    readonly property color syntaxHeading: darkMode ? "#569cd6" : "#0066cc"

    // Emphasis (bold, italic, strikethrough)
    // Bold uses textPrimary with font-weight
    // Italic uses textPrimary with font-style
    readonly property color syntaxStrike: darkMode ? "#808080" : "#6a737d"

    // Links [text](url)
    readonly property color syntaxLink: darkMode ? "#4ec9b0" : "#22863a"
    readonly property color syntaxUrl: darkMode ? "#ce9178" : "#6f42c1"

    // Code (inline `code` and ``` blocks)
    readonly property color syntaxCodeInlineBg: darkMode ? "#2d2d2d" : "#f0f0f0"
    readonly property color syntaxCodeBlockBg: darkMode ? "#1e1e1e" : "#f6f8fa"
    readonly property color syntaxCodeBorder: darkMode ? "#3c3c3c" : "#d0d0d0"

    // Blockquotes (>)
    readonly property color syntaxBlockquote: darkMode ? "#608b4e" : "#6a737d"
    readonly property color syntaxBlockquoteBorder: darkMode ? "#608b4e" : "#dfe2e5"

    // List markers (-, *, 1.)
    readonly property color syntaxListMarker: darkMode ? "#d4d4d4" : "#24292e"

    // Mermaid diagram blocks
    readonly property color syntaxMermaidBg: darkMode ? "#1a365d" : "#ebf8ff"
    readonly property color syntaxMermaidBorder: darkMode ? "#3182ce" : "#3182ce"

    // ========================================
    // Markdown Preview Pane Colors
    // ========================================

    readonly property color previewBackground: darkMode ? "#1e1e1e" : "#ffffff"
    readonly property color previewText: darkMode ? "#d4d4d4" : "#24292e"
    readonly property color previewHeading: darkMode ? "#569cd6" : "#0066cc"
    readonly property color previewLink: darkMode ? "#4ec9b0" : "#0366d6"
    readonly property color previewCodeBg: darkMode ? "#252526" : "#f6f8fa"
    readonly property color previewCodeText: darkMode ? "#d4d4d4" : "#24292e"
    readonly property color previewTableBorder: darkMode ? "#3c3c3c" : "#dfe2e5"
    readonly property color previewTableHeaderBg: darkMode ? "#252526" : "#f6f8fa"
    readonly property color previewBlockquoteBorder: darkMode ? "#3c3c3c" : "#dfe2e5"
    readonly property color previewHrColor: darkMode ? "#3c3c3c" : "#e1e4e8"

    // ========================================
    // Mermaid Diagram Theme Configuration
    // ========================================

    readonly property var mermaidTheme: darkMode ? mermaidDarkTheme : mermaidLightTheme

    readonly property var mermaidDarkTheme: ({
        "theme": "dark",
        "themeVariables": {
            "primaryColor": "#1a365d",
            "primaryTextColor": "#d4d4d4",
            "primaryBorderColor": "#3182ce",
            "lineColor": "#808080",
            "secondaryColor": "#252526",
            "tertiaryColor": "#2d2d2d",
            "background": "#1e1e1e",
            "mainBkg": "#1a365d",
            "nodeBorder": "#3182ce",
            "clusterBkg": "#252526",
            "clusterBorder": "#3c3c3c",
            "titleColor": "#d4d4d4",
            "edgeLabelBackground": "#252526",
            "nodeTextColor": "#d4d4d4",

            // Sequence diagram
            "actorBkg": "#1a365d",
            "actorBorder": "#3182ce",
            "actorTextColor": "#d4d4d4",
            "signalColor": "#d4d4d4",
            "signalTextColor": "#d4d4d4",

            // Flowchart
            "fillType0": "#1a365d",
            "fillType1": "#2d3748",
            "fillType2": "#1a365d",

            // Gantt
            "sectionBkgColor": "#252526",
            "taskBkgColor": "#1a365d",
            "taskBorderColor": "#3182ce",
            "taskTextColor": "#d4d4d4",

            // Pie
            "pie1": "#3182ce",
            "pie2": "#4299e1",
            "pie3": "#63b3ed",
            "pie4": "#90cdf4",
            "pieStrokeColor": "#1e1e1e",
            "pieLegendTextColor": "#d4d4d4"
        }
    })

    readonly property var mermaidLightTheme: ({
        "theme": "default",
        "themeVariables": {
            "primaryColor": "#dbeafe",
            "primaryTextColor": "#1e3a5f",
            "primaryBorderColor": "#3182ce",
            "lineColor": "#6b7280",
            "secondaryColor": "#f3f4f6",
            "tertiaryColor": "#e5e7eb",
            "background": "#ffffff",
            "mainBkg": "#dbeafe",
            "nodeBorder": "#3182ce",
            "clusterBkg": "#f3f4f6",
            "clusterBorder": "#d1d5db",
            "titleColor": "#1e3a5f",
            "edgeLabelBackground": "#ffffff",
            "nodeTextColor": "#1e3a5f",

            // Sequence diagram
            "actorBkg": "#dbeafe",
            "actorBorder": "#3182ce",
            "actorTextColor": "#1e3a5f",
            "signalColor": "#1e3a5f",
            "signalTextColor": "#1e3a5f",

            // Flowchart
            "fillType0": "#dbeafe",
            "fillType1": "#e0f2fe",
            "fillType2": "#bfdbfe",

            // Gantt
            "sectionBkgColor": "#f3f4f6",
            "taskBkgColor": "#dbeafe",
            "taskBorderColor": "#3182ce",
            "taskTextColor": "#1e3a5f",

            // Pie
            "pie1": "#3182ce",
            "pie2": "#60a5fa",
            "pie3": "#93c5fd",
            "pie4": "#bfdbfe",
            "pieStrokeColor": "#ffffff",
            "pieLegendTextColor": "#1e3a5f"
        }
    })
}
```

### Color Palette Rationale

**Dark Theme:**
- Based on VS Code Dark+ theme for familiarity
- Blue accent (#3182ce) for consistency with existing accent color
- Sufficient contrast (>4.5:1) for all text on backgrounds

**Light Theme:**
- Based on GitHub light theme for familiarity
- Same blue accent for consistency
- Clean, professional appearance

### WCAG Contrast Verification

| Color Pair | Ratio | Pass? |
|------------|-------|-------|
| syntaxHeading (#569cd6) on background (#1e1e1e) | 7.2:1 | ✅ AAA |
| syntaxLink (#4ec9b0) on background (#1e1e1e) | 8.1:1 | ✅ AAA |
| previewText (#d4d4d4) on previewBackground (#1e1e1e) | 10.5:1 | ✅ AAA |
| previewHeading (#569cd6) on previewBackground (#1e1e1e) | 7.2:1 | ✅ AAA |

*Light theme ratios similar - all pass AA minimum.*

### Usage Example in QML

```qml
// In MarkdownPreview.qml
Rectangle {
    color: Theme.previewBackground

    Text {
        color: Theme.previewText
    }
}

// In syntax highlighting CSS generation
function generateSyntaxCSS() {
    return `
        .md-heading { color: ${Theme.syntaxHeading}; }
        .md-link { color: ${Theme.syntaxLink}; }
        .md-code-inline { background: ${Theme.syntaxCodeInlineBg}; }
    `;
}
```

### Usage in Mermaid Configuration

```javascript
// In mermaid-config.js or bridge.js
function getMermaidConfig() {
    // Get theme from Qt/QML
    const theme = window.Qt?.Theme?.mermaidTheme || defaultDarkTheme;
    return theme;
}
```

## Testing

### Test Location
- Visual testing in browser
- Contrast verification with external tools

### Test Cases

| Test | Expected | Notes |
|------|----------|-------|
| Dark mode syntax | All elements visible and distinct | Visual check |
| Light mode syntax | All elements visible and distinct | Visual check |
| Dark mode preview | Professional appearance | Visual check |
| Light mode preview | Professional appearance | Visual check |
| Theme toggle | Colors update immediately | Functional |
| Mermaid dark | Diagram readable on dark bg | Visual check |
| Mermaid light | Diagram readable on light bg | Visual check |
| Contrast check | All ratios ≥ 4.5:1 | Tool verification |

### Verification Tools

- [WebAIM Contrast Checker](https://webaim.org/resources/contrastchecker/)
- Browser DevTools color picker with contrast ratio display

## Definition of Done

- [ ] All acceptance criteria met
- [ ] All tasks completed
- [ ] All colors added to Theme.qml
- [ ] Dark theme looks professional
- [ ] Light theme looks professional
- [ ] WCAG AA contrast verified
- [ ] Colors documented
- [ ] Theme toggle works

## Dependencies

- **Depends on:** None (foundational story)
- **Blocks:** 10.5 (Preview Pane), 10.6 (Syntax Highlighting)

## Estimate

1 point

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-28 | 1.0 | Story created from Epic 10.0 | Sarah (PO) |

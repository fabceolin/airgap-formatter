# Story 1.1: Project Setup and Build Pipeline

## Status: Ready for Review

## Story

**As a** developer,
**I want** a properly configured Rust project with WASM compilation support,
**so that** I can build and iterate on the application with confidence.

## Acceptance Criteria

1. Cargo.toml configured with appropriate dependencies (serde, serde_json, wasm-bindgen)
2. WASM target (`wasm32-unknown-unknown`) builds successfully via `cargo build --target wasm32-unknown-unknown`
3. Project structure follows Rust conventions with `src/lib.rs` as WASM entry point
4. `.gitignore` configured for Rust/WASM artifacts
5. Basic CI workflow (GitHub Actions) that builds the WASM target on push
6. README updated with build instructions

## Tasks / Subtasks

- [x] Task 1: Create Cargo.toml with WASM dependencies (AC: 1)
  - [x] Add serde with derive feature
  - [x] Add serde_json
  - [x] Add wasm-bindgen
  - [x] Configure crate-type as cdylib for WASM
  - [x] Set package name to `airgap_json_formatter`

- [x] Task 2: Create src/lib.rs as WASM entry point (AC: 3)
  - [x] Create src directory
  - [x] Create lib.rs with basic wasm-bindgen setup
  - [x] Add placeholder exported function for verification

- [x] Task 3: Update .gitignore for Rust/WASM artifacts (AC: 4)
  - [x] Add /target directory
  - [x] Add Cargo.lock (optional for libraries)
  - [x] Add /dist and /pkg directories
  - [x] Add *.wasm files in root

- [x] Task 4: Verify WASM build works (AC: 2)
  - [x] Run `cargo build --target wasm32-unknown-unknown`
  - [x] Verify no compilation errors
  - [x] Verify .wasm file is generated

- [x] Task 5: Create GitHub Actions CI workflow (AC: 5)
  - [x] Create .github/workflows/ci.yml
  - [x] Configure Rust toolchain setup
  - [x] Add wasm32-unknown-unknown target
  - [x] Run cargo build for WASM target
  - [x] Run cargo test

- [x] Task 6: Update README with build instructions (AC: 6)
  - [x] Add Prerequisites section (Rust, wasm32 target)
  - [x] Add Build Commands section
  - [x] Add Development Setup instructions

## Dev Notes

### Project Structure
```
airgap-json-formatter/
├── src/
│   └── lib.rs              # WASM entry point
├── Cargo.toml
├── .gitignore
├── .github/
│   └── workflows/
│       └── ci.yml
└── README.md
```

### Key Dependencies (Cargo.toml)
```toml
[package]
name = "airgap_json_formatter"
version = "0.1.0"
edition = "2021"

[lib]
crate-type = ["cdylib", "rlib"]

[dependencies]
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"
wasm-bindgen = "0.2"

[profile.release]
opt-level = "s"  # Optimize for size
lto = true
```

### Critical Architecture Rules
- **Zero Network Calls:** Never use fetch, XMLHttpRequest, WebSocket
- **No Persistent Storage:** Never use localStorage, sessionStorage, IndexedDB
- All processing must remain client-side

### Testing

**Test Location:** `src/tests/` (to be created in future stories)

**Testing Framework:** cargo test (built-in Rust testing)

**For this story:** Manual verification that WASM builds and CI passes

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-20 | 1.0 | Initial story creation | Sarah (PO) |

---

## Dev Agent Record

### Agent Model Used
Claude Opus 4.5 (claude-opus-4-5-20251101)

### Debug Log References
None - no blocking issues encountered

### Completion Notes List
- Created Cargo.toml with serde, serde_json, wasm-bindgen dependencies
- Created src/lib.rs with placeholder greet() function and test
- Updated .gitignore for Rust/WASM artifacts (target, dist, pkg, *.wasm, Cargo.lock)
- Verified WASM build succeeds: 37KB wasm file generated
- Created .github/workflows/ci.yml for CI pipeline
- Updated README.md with build instructions and prerequisites
- All tests pass (1 test)

### File List
- Cargo.toml (new)
- src/lib.rs (new)
- .gitignore (modified)
- .github/workflows/ci.yml (new)
- README.md (modified)

---

## QA Results
*To be filled by QA agent*

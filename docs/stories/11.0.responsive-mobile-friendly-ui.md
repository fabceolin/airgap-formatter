# Story 11.0: Responsive Mobile-Friendly UI

## Status: Draft

## Story

**As a** user on a mobile device or small screen,
**I want** the application to be usable on any screen size,
**So that** I can format and view JSON/data on my phone or tablet without being blocked by minimum size requirements.

## Background

The current UI has hard-coded constraints that prevent mobile usage:
- `minimumWidth: 1024` blocks phones and small tablets entirely
- Toolbar has 12+ elements in a fixed horizontal row
- Header elements don't adapt to narrow screens
- SplitPane minimums (300px each) exceed most phone widths

This story implements responsive design patterns that adapt the UI for small screens while preserving the full desktop experience for users on larger displays.

### Current Constraints (To Be Changed)

| Component | Current | Issue |
|-----------|---------|-------|
| Window minimumWidth | 1024px | Blocks mobile |
| Window minimumHeight | 600px | Too tall for landscape phones |
| SplitView orientation switch | 1200px | Good, but panes still too large |
| InputPane minimumWidth | 300px | Half of iPhone width |
| OutputPane minimumWidth | 300px | Half of iPhone width |
| Toolbar | Single row, 12+ items | Overflows on narrow screens |
| Header | Fixed row with badges | Truncates on narrow screens |

### Target Screen Sizes

| Device | Width | Priority |
|--------|-------|----------|
| iPhone SE | 375px | High |
| iPhone 14 | 390px | High |
| iPad Mini | 744px | Medium |
| Small laptop | 1024px | High (current minimum) |
| Desktop | 1280px+ | High (current optimized) |

## Acceptance Criteria

1. Application usable on screens as small as 320px width
2. **Desktop experience unchanged** for screens ≥1024px
3. Toolbar adapts to screen width:
   - ≥1024px: Full toolbar (current layout)
   - 768-1023px: Condensed toolbar (icons + key buttons)
   - <768px: Collapsible menu with essential actions visible
4. Header adapts to screen width:
   - ≥768px: Full header (current layout)
   - <768px: Compact header (title + hamburger/overflow menu)
5. SplitView adapts:
   - ≥768px: Side-by-side or stacked split view
   - <768px: Tab-based input/output toggle (full screen each)
6. Touch targets minimum 44x44px on mobile
7. Text remains readable (minimum 14px on mobile)
8. Keyboard shortcuts still work on desktop
9. All existing functionality preserved
10. Performance not degraded

## Tasks / Subtasks

- [ ] Task 1: Update Main.qml window constraints (AC: 1, 2)
  - [ ] Change `minimumWidth: 320`
  - [ ] Change `minimumHeight: 480`
  - [ ] Add `property bool isMobile: width < 768`
  - [ ] Add `property bool isCompact: width < 1024`
  - [ ] Verify desktop layout unchanged at ≥1024px

- [ ] Task 2: Create responsive Toolbar (AC: 3, 6)
  - [ ] Add `property bool compactMode: window.width < 1024`
  - [ ] Add `property bool mobileMode: window.width < 768`
  - [ ] Desktop (≥1024px): Current layout unchanged
  - [ ] Compact (768-1023px): Hide labels, show icons, merge some buttons
  - [ ] Mobile (<768px): Overflow menu with hamburger, keep Format + primary actions visible
  - [ ] Increase touch targets to 44x44 on mobile

- [ ] Task 3: Create responsive Header (AC: 4, 6)
  - [ ] Desktop (≥768px): Current layout unchanged
  - [ ] Mobile (<768px): Hide "Offline Ready" badge, shorten title, move theme toggle to menu
  - [ ] Keep "Airgap Protected" badge visible (security trust indicator)
  - [ ] Add hamburger menu icon for mobile

- [ ] Task 4: Implement mobile input/output toggle (AC: 5)
  - [ ] Create InputOutputToggle.qml component
  - [ ] On mobile (<768px): Show tabs "Input" | "Output" at top of content area
  - [ ] Tap tab to switch between full-screen input and output
  - [ ] On desktop/tablet: Use existing SplitView
  - [ ] Preserve scroll position when switching

- [ ] Task 5: Adjust SplitView for tablets (AC: 5)
  - [ ] Tablet (768-1023px): Reduce minimum pane sizes to 200px
  - [ ] Ensure split handle is touch-friendly (minimum 24px hit area)
  - [ ] Vertical split for portrait tablets

- [ ] Task 6: Create overflow/hamburger menu (AC: 3, 4)
  - [ ] Create OverflowMenu.qml component
  - [ ] Include: Load, Clear, Minify, indent options, view toggle, theme toggle
  - [ ] Slide-in drawer from right (or bottom sheet)
  - [ ] Touch-friendly list items (48px height)

- [ ] Task 7: Adjust font sizes for mobile (AC: 7)
  - [ ] Create responsive font size properties in Theme.qml
  - [ ] Minimum 14px body text on mobile
  - [ ] Editor font: 14px minimum (currently 14px, verify)
  - [ ] Button text: 14px minimum on mobile

- [ ] Task 8: Touch-friendly adjustments (AC: 6)
  - [ ] Button minimum size: 44x44px on mobile
  - [ ] Increase tap targets for tree view expand/collapse
  - [ ] History panel: Full screen on mobile
  - [ ] Increase padding on interactive elements

- [ ] Task 9: Test keyboard shortcuts (AC: 8)
  - [ ] Verify all shortcuts still work on desktop
  - [ ] Shortcuts should have no effect on touch-only devices
  - [ ] Document any mobile-specific interactions

- [ ] Task 10: Performance testing (AC: 10)
  - [ ] Test on low-end Android device (emulated)
  - [ ] Test on iOS Safari
  - [ ] Verify no layout thrashing during resize
  - [ ] Measure render time on mobile

- [ ] Task 11: Cross-device testing
  - [ ] Test on iPhone Safari (real device or emulator)
  - [ ] Test on Android Chrome (real device or emulator)
  - [ ] Test on iPad
  - [ ] Test on desktop (verify no regression)
  - [ ] Test window resize transitions

## Dev Notes

### Relevant Source Tree

```
qt/qml/
├── Main.qml              # Window constraints, layout switching
├── Toolbar.qml           # Responsive toolbar
├── Header.qml            # Responsive header
├── InputPane.qml         # Min size adjustments
├── OutputPane.qml        # Min size adjustments
├── Theme.qml             # Responsive font sizes
├── InputOutputToggle.qml # NEW: Mobile tab component
└── OverflowMenu.qml      # NEW: Mobile menu component
```

### Responsive Breakpoint Strategy

```qml
// In Main.qml
ApplicationWindow {
    // Responsive breakpoints
    readonly property bool isDesktop: width >= 1024
    readonly property bool isTablet: width >= 768 && width < 1024
    readonly property bool isMobile: width < 768

    // Derived states
    readonly property bool showFullToolbar: isDesktop
    readonly property bool showCompactToolbar: isTablet
    readonly property bool showMobileToolbar: isMobile
    readonly property bool useSplitView: !isMobile
    readonly property bool useTabView: isMobile
}
```

### Mobile Input/Output Toggle

```qml
// InputOutputToggle.qml
Item {
    id: inputOutputToggle

    property string activePane: "input"  // "input" or "output"
    property alias inputContent: inputLoader.sourceComponent
    property alias outputContent: outputLoader.sourceComponent

    ColumnLayout {
        anchors.fill: parent
        spacing: 0

        // Tab bar
        RowLayout {
            Layout.fillWidth: true
            height: 44
            spacing: 0

            TabButton {
                Layout.fillWidth: true
                text: "Input"
                checked: activePane === "input"
                onClicked: activePane = "input"
            }

            TabButton {
                Layout.fillWidth: true
                text: "Output"
                checked: activePane === "output"
                onClicked: activePane = "output"
            }
        }

        // Content area
        StackLayout {
            Layout.fillWidth: true
            Layout.fillHeight: true
            currentIndex: activePane === "input" ? 0 : 1

            Loader {
                id: inputLoader
            }

            Loader {
                id: outputLoader
            }
        }
    }
}
```

### Toolbar Responsive Layout

```qml
// In Toolbar.qml
Rectangle {
    id: toolbar
    height: window.isMobile ? 56 : 50  // Larger on mobile for touch

    // Mobile: Essential buttons only + overflow menu
    // Tablet: Icon buttons + key actions
    // Desktop: Full current layout

    RowLayout {
        anchors.fill: parent
        anchors.margins: 8
        spacing: window.isMobile ? 4 : 8

        // Always visible: Format button (primary CTA)
        Button {
            id: formatButton
            visible: true  // Always visible
            // ... existing implementation
        }

        // Desktop/Tablet: Show more buttons
        Button {
            id: minifyButton
            visible: !window.isMobile
            // ... existing implementation
        }

        // ... conditional visibility for other buttons

        Item { Layout.fillWidth: true }

        // Mobile: Overflow menu button
        Button {
            id: overflowMenuButton
            visible: window.isMobile
            text: "☰"
            onClicked: overflowMenu.open()
        }

        // Desktop: Copy button visible
        Button {
            id: copyButton
            visible: !window.isMobile
            // ... existing implementation
        }
    }
}
```

### Header Responsive Layout

```qml
// In Header.qml
Rectangle {
    id: header
    height: window.isMobile ? 48 : 40  // Slightly taller on mobile

    RowLayout {
        anchors.fill: parent
        anchors.leftMargin: window.isMobile ? 12 : 16
        anchors.rightMargin: window.isMobile ? 12 : 16

        // App Title - shortened on mobile
        Text {
            text: window.isMobile ? "Airgap" : "Airgap JSON Formatter"
            // ...
        }

        // Version - hidden on mobile
        Text {
            visible: !window.isMobile
            text: "v" + Theme.appVersion
            // ...
        }

        Item { Layout.fillWidth: true }

        // Airgap badge - always visible (trust indicator)
        Rectangle {
            id: airgapBadge
            // Compact version on mobile
            width: window.isMobile ? airgapIconOnly.width + 12 : airgapRow.width + 16
            // ...
        }

        // Offline badge - hidden on mobile
        Rectangle {
            visible: !window.isMobile && header.offlineReady
            // ...
        }

        // Theme toggle - in menu on mobile
        Rectangle {
            visible: !window.isMobile
            // ...
        }
    }
}
```

### Theme.qml Responsive Properties

```qml
// Add to Theme.qml
// Responsive sizing
readonly property int touchTargetSize: 44  // Minimum touch target (Apple HIG)
readonly property int mobileButtonHeight: 44
readonly property int desktopButtonHeight: 34

readonly property int mobileFontSize: 14
readonly property int desktopFontSize: 13

// Use in components:
// font.pixelSize: window.isMobile ? Theme.mobileFontSize : Theme.desktopFontSize
```

### CSS Media Queries Alternative

If using WebEngineView for preview, can use CSS media queries:

```css
@media (max-width: 767px) {
    body {
        font-size: 14px;
        padding: 8px;
    }
}

@media (min-width: 768px) {
    body {
        font-size: 16px;
        padding: 16px;
    }
}
```

### Testing Matrix

| Screen | Width | Layout | Toolbar | Split |
|--------|-------|--------|---------|-------|
| iPhone SE | 375px | Mobile | Overflow | Tab |
| iPhone 14 | 390px | Mobile | Overflow | Tab |
| iPad Mini Port | 744px | Mobile | Overflow | Tab |
| iPad Mini Land | 1024px | Desktop | Full | Split |
| iPad Pro Port | 834px | Tablet | Compact | Split |
| iPad Pro Land | 1194px | Desktop | Full | Split |
| Laptop | 1280px | Desktop | Full | Split |
| Desktop | 1920px | Desktop | Full | Split |

## Testing

### Test Location
- Device testing: Real devices + emulators
- Browser DevTools: Responsive mode

### Test Cases

| Scenario | Expected | Notes |
|----------|----------|-------|
| 320px width | Usable, no overflow | Minimum supported |
| 375px width (iPhone) | Mobile layout, tabs | Common phone |
| 768px width | Tablet/compact layout | Breakpoint |
| 1024px width | Full desktop layout | Breakpoint |
| Window resize 1024→375 | Smooth transition | No layout jump |
| Touch Format button (mobile) | 44px target, works | Touch-friendly |
| Keyboard Ctrl+Shift+F (desktop) | Still works | No regression |
| Paste JSON on mobile | Works via menu | Touch-friendly |

### Device Testing Checklist

- [ ] iPhone Safari (real or simulator)
- [ ] Android Chrome (real or emulator)
- [ ] iPad Safari (real or simulator)
- [ ] Desktop Chrome
- [ ] Desktop Firefox
- [ ] Desktop Safari
- [ ] Window resize (all sizes)

## Definition of Done

- [ ] All acceptance criteria met
- [ ] Desktop experience unchanged at ≥1024px
- [ ] Mobile usable at 320px minimum
- [ ] Touch targets ≥44px on mobile
- [ ] All functionality accessible on all screen sizes
- [ ] Cross-device testing complete
- [ ] No performance regression
- [ ] Code reviewed

## Compatibility Requirements

- [x] Desktop functionality preserved (unchanged at ≥1024px)
- [x] All keyboard shortcuts work on desktop
- [x] Existing automation/testing unaffected
- [x] Theme toggle accessible on all sizes
- [x] History panel accessible on all sizes

## Risks & Mitigations

| Risk | Impact | Likelihood | Mitigation |
|------|--------|------------|------------|
| Qt WASM touch issues | High | Medium | Test early, have fallback interactions |
| Layout thrashing on resize | Medium | Low | Use smooth transitions, debounce |
| Desktop regression | High | Low | Extensive desktop testing |
| Performance on mobile | Medium | Medium | Profile, optimize critical paths |

## Out of Scope

- Native mobile app (this is responsive web)
- Offline mobile-specific features
- Mobile-specific gestures (pinch-zoom, swipe)
- PWA installation prompt (future story)

## Dependencies

- **Depends on:** None (can start immediately)
- **Blocks:** None (enhancement)

## Estimate

5 points (significant UI refactoring)

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-28 | 1.0 | Story created | Sarah (PO) |

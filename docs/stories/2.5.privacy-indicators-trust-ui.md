# Story 2.5: Privacy Indicators and Trust UI

## Status: Ready for Review

## Story

**As a** user,
**I want** visible confirmation that my data stays local,
**so that** I can trust the application with sensitive JSON.

## Acceptance Criteria

1. Header bar displays "Airgap Protected" badge with lock icon
2. Network status indicator shows "Offline Ready" after initial load
3. Subtle footer text: "All processing happens locally. Your data never leaves this device."
4. No loading spinners or network activity indicators after initial load
5. Console logs confirm zero network requests during operation (verifiable in DevTools)

## Tasks / Subtasks

- [x] Task 1: Create Header.qml component (AC: 1)
  - [x] Create `qt/qml/Header.qml`
  - [x] Add application title "Airgap JSON Formatter"
  - [x] Add "Airgap Protected" badge with lock icon
  - [x] Style with dark theme
  - [x] Position at top of window

- [x] Task 2: Implement Airgap Protected badge (AC: 1)
  - [x] Create badge with lock icon (ğŸ”’ or SVG)
  - [x] Add "Airgap Protected" text
  - [x] Style with subtle accent color
  - [x] Add tooltip explaining protection

- [x] Task 3: Implement network status indicator (AC: 2)
  - [x] Add "Offline Ready" indicator to header
  - [x] Show indicator after WASM initialization completes
  - [x] Use appropriate icon (checkmark or signal bars)
  - [x] Add tooltip explaining offline capability

- [x] Task 4: Update StatusBar with privacy footer text (AC: 3)
  - [x] Add right-aligned privacy text to StatusBar
  - [x] Text: "All processing happens locally. Your data never leaves this device."
  - [x] Style with subtle secondary color
  - [x] Make text subtle but readable

- [x] Task 5: Remove/prevent loading indicators after init (AC: 4)
  - [x] Ensure no spinners appear during format/minify operations
  - [x] Operations should be instant (WASM is fast)
  - [x] Remove any placeholder loading states

- [x] Task 6: Add console verification logging (AC: 5)
  - [x] Log "Airgap Mode Active" on initialization
  - [x] Log "Zero network requests - all processing local"
  - [x] These logs help users verify in DevTools
  - [x] Keep logging minimal and professional

- [x] Task 7: Integrate Header into Main.qml (AC: 1, 2)
  - [x] Add Header above Toolbar
  - [x] Set up initialization signal for "Offline Ready"
  - [x] Connect WASM ready state to indicator

- [x] Task 8: Update CMakeLists.txt (AC: 1)
  - [x] Add Header.qml to QML_FILES

## Dev Notes

### QML File Structure
```
qt/qml/
â”œâ”€â”€ Main.qml          # Updated with Header
â”œâ”€â”€ Header.qml        # NEW: Title and trust indicators
â”œâ”€â”€ Theme.qml
â”œâ”€â”€ Toolbar.qml
â”œâ”€â”€ InputPane.qml
â”œâ”€â”€ OutputPane.qml
â””â”€â”€ StatusBar.qml     # Updated with privacy text
```

### Header.qml

```qml
// qt/qml/Header.qml
import QtQuick
import QtQuick.Controls
import QtQuick.Layouts

Rectangle {
    id: header
    height: 40
    color: Theme.background

    property bool offlineReady: false

    RowLayout {
        anchors.fill: parent
        anchors.leftMargin: 16
        anchors.rightMargin: 16
        spacing: 16

        // App Title
        Text {
            text: "Airgap JSON Formatter"
            color: Theme.textPrimary
            font.pixelSize: 18
            font.weight: Font.Medium
        }

        Item { Layout.fillWidth: true }  // Spacer

        // Airgap Protected Badge
        Rectangle {
            id: airgapBadge
            width: airgapRow.width + 16
            height: 26
            radius: 4
            color: "#1a3a1a"
            border.color: "#2d5a2d"
            border.width: 1

            Row {
                id: airgapRow
                anchors.centerIn: parent
                spacing: 6

                Text {
                    text: "ğŸ”’"
                    font.pixelSize: 14
                }

                Text {
                    text: "Airgap Protected"
                    color: Theme.textSuccess
                    font.pixelSize: 12
                    font.weight: Font.Medium
                }
            }

            ToolTip {
                visible: airgapBadgeMouseArea.containsMouse
                text: "All data processing happens locally in your browser.\nNo data is ever sent to external servers."
                delay: 500
            }

            MouseArea {
                id: airgapBadgeMouseArea
                anchors.fill: parent
                hoverEnabled: true
            }
        }

        // Offline Ready Indicator
        Rectangle {
            id: offlineBadge
            visible: header.offlineReady
            width: offlineRow.width + 12
            height: 26
            radius: 4
            color: "transparent"
            border.color: Theme.border
            border.width: 1

            Row {
                id: offlineRow
                anchors.centerIn: parent
                spacing: 4

                Text {
                    text: "âœ“"
                    color: Theme.textSuccess
                    font.pixelSize: 12
                }

                Text {
                    text: "Offline Ready"
                    color: Theme.textSecondary
                    font.pixelSize: 12
                }
            }

            ToolTip {
                visible: offlineBadgeMouseArea.containsMouse
                text: "Application is fully loaded and can work without internet connection."
                delay: 500
            }

            MouseArea {
                id: offlineBadgeMouseArea
                anchors.fill: parent
                hoverEnabled: true
            }
        }
    }
}
```

### StatusBar.qml Updates (Privacy Text)

```qml
// StatusBar.qml additions
RowLayout {
    // ... existing content ...

    Item { Layout.fillWidth: true }  // Spacer (if not already present)

    // Privacy Footer Text
    Text {
        text: "All processing happens locally. Your data never leaves this device."
        color: Theme.textSecondary
        font.pixelSize: 11
        opacity: 0.8
    }
}
```

### Main.qml Layout Update

```qml
// Main.qml updated layout
ColumnLayout {
    anchors.fill: parent
    spacing: 0

    Header {
        id: header
        Layout.fillWidth: true
        offlineReady: wasmInitialized  // Set after WASM loads
    }

    Toolbar {
        id: toolbar
        Layout.fillWidth: true
        // ... existing properties
    }

    SplitView {
        id: splitView
        Layout.fillWidth: true
        Layout.fillHeight: true
        // ... existing content
    }

    StatusBar {
        id: statusBar
        Layout.fillWidth: true
        // ... existing properties
    }
}

property bool wasmInitialized: false

Component.onCompleted: {
    // Initialize WASM and set offline ready
    initBridge().then(() => {
        wasmInitialized = true;
        console.log("[Airgap] Mode Active - Zero network requests, all processing local");
    });
}
```

### Console Verification Logs

```javascript
// public/bridge.js additions
async function initBridge() {
    console.log("[Airgap] Initializing local JSON processor...");

    const wasm = await import('./pkg/airgap_json_formatter.js');
    await wasm.default();
    wasmModule = wasm;

    console.log("[Airgap] âœ“ Rust WASM module loaded");
    console.log("[Airgap] âœ“ All processing happens locally in browser");
    console.log("[Airgap] âœ“ Zero network requests - data never leaves device");
    console.log("[Airgap] Mode Active - Ready for secure JSON processing");
}
```

### Visual Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Airgap JSON Formatter          [ğŸ”’ Airgap Protected] [âœ“ Offline Ready] â”‚  â† Header
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [Format] [Minify]  Indent: [4 spaces â–¼]    [Copy] [Clear] â”‚  â† Toolbar
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                             â”‚                              â”‚
â”‚     Input Pane              â”‚      Output Pane             â”‚
â”‚     (editable)              â”‚      (read-only)             â”‚
â”‚                             â”‚                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ“ Valid JSON | Objects: 2 | Keys: 5      [privacy text...] â”‚  â† StatusBar
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Critical Architecture Rules
- **Zero Network Calls:** Never use fetch, XMLHttpRequest, WebSocket
- **No Persistent Storage:** Never use localStorage, sessionStorage, IndexedDB
- **Trust Indicators:** Always visible to reinforce privacy guarantee

### Testing

**Manual Verification:**
1. Verify "Airgap Protected" badge displays in header
2. Hover over badge - verify tooltip appears
3. Verify "Offline Ready" indicator shows after load
4. Verify privacy text in status bar
5. Open DevTools Network tab - verify zero requests during use
6. Check Console for Airgap mode logs
7. Disconnect internet - verify app still works (offline)
8. Verify no loading spinners during format/minify

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-20 | 1.0 | Initial story creation | Sarah (PO) |

---

## Dev Agent Record

### Agent Model Used
Claude Opus 4.5 (claude-opus-4-5-20251101)

### Debug Log References
None - Qt WASM toolchain not available for runtime testing

### Completion Notes List
- Created Header.qml with app title, Airgap Protected badge, and Offline Ready indicator
- Airgap Protected badge styled with green background (#1a3a1a) and lock icon emoji
- Badge has tooltip explaining data processing happens locally
- Offline Ready indicator shows checkmark and appears when WASM is initialized
- Offline indicator has tooltip explaining offline capability
- Added subtle bottom border to header for visual separation
- Updated StatusBar.qml with right-aligned privacy footer text
- Privacy text styled with secondary color at 80% opacity
- Main.qml updated with wasmInitialized property and Component.onCompleted handler
- Header integrated above Toolbar in the layout
- Console logging already implemented in bridge.js (Story 2.1)
- No loading spinners implemented - operations are instant

### File List
- qt/qml/Header.qml (new)
- qt/qml/StatusBar.qml (modified)
- qt/qml/Main.qml (modified)
- qt/CMakeLists.txt (modified)

---

## QA Results
*To be filled by QA agent*
